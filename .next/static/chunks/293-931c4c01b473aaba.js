"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{3941:(e,t,r)=>{r.d(t,{$:()=>u,N:()=>i});var n=r(6347),a=r(5704);let l=a.env.NEXT_PUBLIC_SUPABASE_URL,s=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;l&&s||console.warn("Supabase credentials not found. Using mock services.");let i=l&&s?(0,n.UU)(l,s):null,u=!!i},7135:(e,t,r)=>{r.d(t,{y1:()=>v,gy:()=>m,Lh:()=>_});let n="blend_auth_user";class a{async signIn(e){await new Promise(e=>setTimeout(e,500));let t=JSON.parse(localStorage.getItem("blend_users")||"[]"),r=t.find(t=>t.email===e);if(r)return localStorage.setItem(n,JSON.stringify(r)),{user:r,error:null};{let r={id:crypto.randomUUID(),email:e,name:e.split("@")[0],created_at:new Date().toISOString(),avatar_url:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e)};return t.push(r),localStorage.setItem("blend_users",JSON.stringify(t)),localStorage.setItem(n,JSON.stringify(r)),{user:r,error:null}}}async signUp(e,t){await new Promise(e=>setTimeout(e,500));let r=JSON.parse(localStorage.getItem("blend_users")||"[]");if(r.find(t=>t.email===e))return{user:null,error:"User already exists"};let a={id:crypto.randomUUID(),email:e,name:t||e.split("@")[0],created_at:new Date().toISOString(),avatar_url:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e)};return r.push(a),localStorage.setItem("blend_users",JSON.stringify(r)),localStorage.setItem(n,JSON.stringify(a)),{user:a,error:null}}async signOut(){return localStorage.removeItem(n),{error:null}}async getCurrentUser(){let e=localStorage.getItem(n);return e?{user:JSON.parse(e),error:null}:{user:null,error:null}}}let l="blend_events";class s{getStoredEvents(){return JSON.parse(localStorage.getItem(l)||"[]")}getCurrentUserId(){let e=localStorage.getItem("blend_auth_user");return e?JSON.parse(e).id:null}async createEvent(e){await new Promise(e=>setTimeout(e,600));let t=this.getCurrentUserId();if(!t)return{event:null,error:"Unauthorized"};let r={id:crypto.randomUUID(),host_id:t,created_at:new Date().toISOString(),...e},n=this.getStoredEvents();return n.push(r),localStorage.setItem(l,JSON.stringify(n)),{event:r,error:null}}async getEvents(e){await new Promise(e=>setTimeout(e,400));let t=this.getStoredEvents(),r=(null==e?void 0:e.host_id)||this.getCurrentUserId();return r?{events:t.filter(e=>e.host_id===r).sort((e,t)=>new Date(e.start_date).getTime()-new Date(t.start_date).getTime()),error:null}:{events:t.filter(e=>"public"===e.visibility),error:null}}async getEventById(e){await new Promise(e=>setTimeout(e,300));let t=this.getStoredEvents().find(t=>t.id===e);return{event:t||null,error:t?null:"Event not found"}}async updateEvent(e,t){await new Promise(e=>setTimeout(e,500));let r=this.getStoredEvents(),n=r.findIndex(t=>t.id===e);if(-1===n)return{event:null,error:"Event not found"};let a=this.getCurrentUserId();if(r[n].host_id!==a)return{event:null,error:"Unauthorized"};let s={...r[n],...t};return r[n]=s,localStorage.setItem(l,JSON.stringify(r)),{event:s,error:null}}async getEventBySlug(e){await new Promise(e=>setTimeout(e,300));let t=this.getStoredEvents().find(t=>t.slug===e);return{event:t||null,error:t?null:"Event not found"}}async deleteEvent(e){await new Promise(e=>setTimeout(e,500));let t=this.getStoredEvents(),r=t.findIndex(t=>t.id===e);if(-1===r)return{error:"Event not found"};let n=this.getCurrentUserId();return t[r].host_id!==n?{error:"Unauthorized"}:(t.splice(r,1),localStorage.setItem(l,JSON.stringify(t)),{error:null})}async publishEvent(e){return this.updateEvent(e,{status:"published",published_at:new Date().toISOString()})}async cancelEvent(e){return this.updateEvent(e,{status:"cancelled"})}}var i=r(3941);let u="blend_auth_user";class o{async signIn(e){if(!i.N)return{user:null,error:"Supabase not configured"};let t="".concat(window.location.origin,"/events"),{error:r}=await i.N.auth.signInWithOtp({email:e,options:{emailRedirectTo:t}});return r?{user:null,error:r.message}:{user:null,error:null}}async signInWithGoogle(){if(!i.N)return{error:"Supabase not configured"};let e="".concat(window.location.origin,"/events"),{error:t}=await i.N.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{access_type:"offline",prompt:"consent"}}});return t?{error:t.message}:{error:null}}async signUp(e,t){return this.signIn(e)}async signOut(){if(!i.N)return localStorage.removeItem(u),{error:null};let{error:e}=await i.N.auth.signOut();return{error:(null==e?void 0:e.message)||null}}async getCurrentUser(){var e,t,r,n,a;if(!i.N){let e=localStorage.getItem(u);return e?{user:JSON.parse(e),error:null}:{user:null,error:null}}let{data:{user:l},error:s}=await i.N.auth.getUser();return s||!l?{user:null,error:(null==s?void 0:s.message)||null}:{user:{id:l.id,email:l.email||"",name:(null==(e=l.user_metadata)?void 0:e.full_name)||(null==(t=l.user_metadata)?void 0:t.name)||(null==(r=l.email)?void 0:r.split("@")[0])||"User",avatar_url:(null==(n=l.user_metadata)?void 0:n.avatar_url)||(null==(a=l.user_metadata)?void 0:a.picture),created_at:l.created_at},error:null}}onAuthStateChange(e){if(!i.N)return()=>{};let{data:{subscription:t}}=i.N.auth.onAuthStateChange(async(t,r)=>{if(null==r?void 0:r.user){var n,a,l,s,i;e({id:r.user.id,email:r.user.email||"",name:(null==(n=r.user.user_metadata)?void 0:n.full_name)||(null==(a=r.user.user_metadata)?void 0:a.name)||(null==(l=r.user.email)?void 0:l.split("@")[0])||"User",avatar_url:(null==(s=r.user.user_metadata)?void 0:s.avatar_url)||(null==(i=r.user.user_metadata)?void 0:i.picture),created_at:r.user.created_at})}else e(null)});return()=>t.unsubscribe()}}let d=i.$;class c{async createEvent(e){if(!i.N)return{event:null,error:"Supabase not configured"};let{data:{user:t}}=await i.N.auth.getUser();if(!t)return{event:null,error:"Not authenticated"};let{data:r,error:n}=await i.N.from("events").insert({host_id:t.id,title:e.title,description:e.description,start_date:e.start_date,end_date:e.end_date,location_type:e.location_type,location_url:e.location_url,cover_image_url:e.cover_image_url,theme:e.theme,capacity:e.capacity,price_cents:e.price?100*parseInt(String(e.price).replace(/[^0-9]/g,"")):0,visibility:e.visibility||"public"}).select().single();return n?{event:null,error:n.message}:{event:r,error:null}}async getEvents(e){if(!i.N)return{events:[],error:"Supabase not configured"};let t=i.N.from("events").select("*"),r=null==e?void 0:e.host_id;if(r)t=t.eq("host_id",r);else{let{data:{user:e}}=await i.N.auth.getUser();t=e?t.eq("host_id",e.id):t.eq("visibility","public")}(null==e?void 0:e.status)&&(t=t.eq("status",e.status)),(null==e?void 0:e.visibility)&&(t=t.eq("visibility",e.visibility)),(null==e?void 0:e.calendar_id)&&(t=t.eq("calendar_id",e.calendar_id));let{data:n,error:a}=await t.order("start_date",{ascending:!0});return a?{events:[],error:a.message}:{events:n||[],error:null}}async getEventById(e){if(!i.N)return{event:null,error:"Supabase not configured"};let{data:t,error:r}=await i.N.from("events").select("*").eq("id",e).single();return r?{event:null,error:r.message}:{event:t,error:null}}async updateEvent(e,t){if(!i.N)return{event:null,error:"Supabase not configured"};let{data:r,error:n}=await i.N.from("events").update(t).eq("id",e).select().single();return n?{event:null,error:n.message}:{event:r,error:null}}async getEventBySlug(e){if(!i.N)return{event:null,error:"Supabase not configured"};let{data:t,error:r}=await i.N.from("events").select("*").eq("slug",e).single();return r?{event:null,error:r.message}:{event:t,error:null}}async deleteEvent(e){if(!i.N)return{error:"Supabase not configured"};let{data:{user:t}}=await i.N.auth.getUser();if(!t)return{error:"Not authenticated"};let{error:r}=await i.N.from("events").delete().eq("id",e).eq("host_id",t.id);return r?{error:r.message}:{error:null}}async publishEvent(e){return this.updateEvent(e,{status:"published",published_at:new Date().toISOString()})}async cancelEvent(e){return this.updateEvent(e,{status:"cancelled"})}}let g=i.$,v=d?new o:new a,m=g?new c:new s,_=d&&g},9293:(e,t,r)=>{r.d(t,{A:()=>o,O:()=>u});var n=r(5155),a=r(2115),l=r(7135),s=r(3941);let i=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if((async()=>{let{user:e}=await l.y1.getCurrentUser();u(e),d(!1)})(),s.N){let{data:{subscription:e}}=s.N.auth.onAuthStateChange(async(e,t)=>{if(null==t?void 0:t.user){var r,n,a;u({id:t.user.id,email:t.user.email||"",name:(null==(r=t.user.user_metadata)?void 0:r.name)||(null==(n=t.user.email)?void 0:n.split("@")[0])||"User",avatar_url:null==(a=t.user.user_metadata)?void 0:a.avatar_url,created_at:t.user.created_at})}else u(null);d(!1)});return()=>e.unsubscribe()}},[]);let c=async e=>{let{user:t,error:r}=await l.y1.signIn(e);return t?(u(t),{error:r,magicLinkSent:!1}):l.Lh&&!r?{error:null,magicLinkSent:!0}:{error:r,magicLinkSent:!1}},g=async()=>{if("signInWithGoogle"in l.y1){let{error:e}=await l.y1.signInWithGoogle();return{error:e}}return u({id:"google-user-"+Date.now(),email:"google.user@gmail.com",name:"Google User",avatar_url:"https://lh3.googleusercontent.com/a/default-user",created_at:new Date().toISOString()}),{error:null}},v=async()=>{await l.y1.signOut(),u(null)};return(0,n.jsx)(i.Provider,{value:{user:r,loading:o,signIn:c,signInWithGoogle:g,signOut:v,isSupabase:l.Lh},children:t})}function o(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);